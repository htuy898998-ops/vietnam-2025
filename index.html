<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 æ—¥æœ¬é—œè¥¿è¶Šå¾Œæ¹¯æ¾¤ä¹‹æ—…</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        muji: {
                            bg: '#f5f5f0',       /* ç±³ç™½èƒŒæ™¯ */
                            card: '#ffffff',     /* ç´”ç™½å¡ç‰‡ */
                            text: '#4a4a4a',     /* æ·±ç°æ–‡å­— */
                            sub: '#8e8e8e',      /* æ·ºç°å‰¯æ¨™ */
                            accent: '#7d6c5e',   /* å¤§åœ°æ£•å¼·èª¿è‰² */
                            danger: '#cf5c5c',   /* æŸ”å’Œç´… */
                            success: '#7ea87e'   /* æŠ¹èŒ¶ç¶  */
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', '"Lato"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f5f5f0;
            color: #4a4a4a;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 80px; /* Space for bottom nav */
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .card-shadow {
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        /* Tab Transitions */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .nav-item.active {
            color: #7d6c5e;
        }
        .timeline-line {
            position: absolute;
            left: 16px;
            top: 10px;
            bottom: -20px;
            width: 2px;
            background-color: #e5e5e5;
            z-index: 0;
        }
        .timeline-dot {
            z-index: 10;
        }
    </style>
</head>
<body>

    <header class="fixed top-0 w-full bg-[#f5f5f0]/95 backdrop-blur-sm z-50 px-5 py-4 shadow-sm border-b border-stone-200">
        <h1 class="text-xl font-bold tracking-widest text-muji-accent">TRAVEL <span class="text-sm font-normal text-muji-text">2026 Osaka & Yuzawa</span></h1>
    </header>

    <main class="pt-20 px-4 max-w-md mx-auto">
        
        <section id="plan" class="tab-content active">
            <div class="bg-white rounded-2xl p-5 mb-6 card-shadow border border-stone-100">
                <h2 class="text-sm font-bold text-muji-sub mb-3 uppercase tracking-wider"><i class="fas fa-plane"></i> èˆªç­è³‡è¨Š</h2>
                <div class="flex justify-between items-center mb-2">
                    <div class="text-center">
                        <div class="text-2xl font-bold">TPE</div>
                        <div class="text-xs text-muji-sub">14:20</div>
                    </div>
                    <div class="flex-1 px-4 text-center">
                        <div class="text-xs text-muji-accent font-bold">IT210</div>
                        <div class="h-[1px] bg-stone-300 w-full my-1 relative">
                            <i class="fas fa-plane absolute top-[-7px] left-1/2 transform -translate-x-1/2 text-stone-300 text-xs"></i>
                        </div>
                        <div class="text-xs text-muji-sub">1/24 (å…­)</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold">KIX</div>
                        <div class="text-xs text-muji-sub">17:45</div>
                    </div>
                </div>
                <hr class="border-dashed border-stone-200 my-3">
                <div class="flex justify-between items-center">
                    <div class="text-center">
                        <div class="text-2xl font-bold">KIX</div>
                        <div class="text-xs text-muji-sub">11:30</div>
                    </div>
                    <div class="flex-1 px-4 text-center">
                        <div class="text-xs text-muji-accent font-bold">IT211</div>
                        <div class="h-[1px] bg-stone-300 w-full my-1 relative">
                            <i class="fas fa-plane absolute top-[-7px] left-1/2 transform -translate-x-1/2 text-stone-300 text-xs transform rotate-180"></i>
                        </div>
                        <div class="text-xs text-muji-sub">2/1 (æ—¥)</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold">TPE</div>
                        <div class="text-xs text-muji-sub">13:50</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-5 mb-6 card-shadow border border-stone-100">
                <h2 class="text-sm font-bold text-muji-sub mb-3 uppercase tracking-wider"><i class="fas fa-bed"></i> ä½å®¿å®‰æ’</h2>
                <div class="space-y-3 text-sm">
                    <div class="flex">
                        <span class="w-16 font-bold text-muji-accent shrink-0">D1-2</span>
                        <div>
                            <div class="font-bold">Hotel Forza Osaka Kitahama</div>
                            <a href="https://www.google.com/maps/search/?api=1&query=Hotel+Forza+Osaka+Kitahama" target="_blank" class="text-xs text-blue-400 hover:text-blue-600"><i class="fas fa-map-marker-alt"></i> åŒ—æ¿±ç«™</a>
                        </div>
                    </div>
                    <div class="flex">
                        <span class="w-16 font-bold text-muji-accent shrink-0">D3-5</span>
                        <div>
                            <div class="font-bold">è¶Šå¾Œæ¹¯æ¾¤ å¾¡æ¹¯å®¿ ä¸­å±‹</div>
                            <a href="https://www.google.com/maps/search/?api=1&query=Echigo+Yuzawa+Hatago+Isen" target="_blank" class="text-xs text-blue-400 hover:text-blue-600"><i class="fas fa-map-marker-alt"></i> æº«æ³‰æ—…é¤¨</a>
                        </div>
                    </div>
                    <div class="flex">
                        <span class="w-16 font-bold text-muji-accent shrink-0">D6-8</span>
                        <div>
                            <div class="font-bold">Hotel Forza Osaka Kitahama</div>
                            <span class="text-xs text-muji-sub">å›åˆ°å¤§é˜ª</span>
                        </div>
                    </div>
                </div>
            </div>

            <h2 class="text-lg font-bold mb-4 text-muji-text">è¡Œç¨‹ä¸€è¦½</h2>
            <div id="itinerary-container">
                </div>
        </section>

        <section id="guide" class="tab-content">
            <h2 class="text-2xl font-serif font-bold mb-2">Travel Guide</h2>
            <p class="text-sm text-muji-sub mb-6">æ·±åº¦å°è¦½èˆ‡é‡é»ä»‹ç´¹</p>

            <div class="bg-white rounded-2xl overflow-hidden card-shadow mb-6">
                <div class="h-40 bg-gray-200 bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1542051841857-5f90071e7989?q=80&w=1000&auto=format&fit=crop');">
                    <div class="w-full h-full bg-black/20 flex items-end p-4">
                        <h3 class="text-white font-bold text-xl text-shadow">æ¸…æ´¥å³½ (Kiyotsu Gorge)</h3>
                    </div>
                </div>
                <div class="p-5">
                    <p class="text-sm leading-relaxed text-justify mb-4">
                        æ—¥æœ¬ä¸‰å¤§å³½è°·ä¹‹ä¸€ã€‚2018å¹´ç¶“ç”±é¦¬å²©æ¾å¸¶é ˜çš„ MAD å»ºç¯‰äº‹å‹™æ‰€æ”¹é€ ï¼Œå°‡åŸæœ¬å–®èª¿çš„éš§é“è®Šæˆäº†å…‰å½±è—è¡“è£ç½®ã€‚æœ€è‘—åçš„ã€Œå…‰ä¹‹éš§é“ã€ç›¡é ­ï¼Œæ°´ç›¤é¡é¢åå°„å‡ºå³½è°·Vå­—å‹çš„çµ•æ™¯ï¼Œæ˜¯çµ•ç¾çš„æ‰“å¡é»ã€‚
                    </p>
                    <div class="bg-stone-50 p-3 rounded-lg border border-stone-200 text-xs">
                        <strong class="text-muji-accent">ğŸ’¡ æ‹æ”æŠ€å·§</strong><br>
                        ç«™åœ¨æ°´æ± ä¸­é–“ï¼ˆæ°´å¾ˆæ·ºï¼‰ï¼Œè®“æ”å½±å¸«å¾éš§é“å…§éƒ¨å¾€å¤–æ‹ï¼Œå¯ä»¥æ‹å‡ºå®Œç¾çš„å‰ªå½±å€’å½±ã€‚
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl overflow-hidden card-shadow mb-6 p-4">
                <h3 class="font-bold text-lg mb-2">å¤§é˜ªæ¨‚é«˜æ¨‚åœ’ä½ç½®</h3>
                <div class="w-full h-64 bg-gray-100 rounded-lg overflow-hidden">
                   <iframe width="100%" height="100%" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://www.openstreetmap.org/export/embed.html?bbox=135.42878150939944%2C34.653606612716335%2C135.43697834014895%2C34.65751276088288&amp;layer=mapnik&amp;marker=34.65555969501538%2C135.43287992477417" style="border: 0"></iframe>
                </div>
                <div class="mt-2 flex justify-between items-center">
                    <span class="text-xs text-muji-sub">å¤©ä¿å±±è³¼ç‰©ä¸­å¿ƒå…§</span>
                    <a href="https://www.google.com/maps/search/?api=1&query=LEGOLAND+Discovery+Center+Osaka" target="_blank" class="bg-muji-accent text-white px-3 py-1 rounded-full text-xs">Google Maps</a>
                </div>
            </div>
            
             <div class="bg-white rounded-2xl overflow-hidden card-shadow mb-6">
                <div class="h-40 bg-gray-200 bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1478436127897-769e1b3f0f36?q=80&w=1000&auto=format&fit=crop');">
                    <div class="w-full h-full bg-black/20 flex items-end p-4">
                        <h3 class="text-white font-bold text-xl text-shadow">è¶Šå¾Œæ¹¯æ¾¤ (é›ªåœ‹)</h3>
                    </div>
                </div>
                <div class="p-5">
                    <p class="text-sm leading-relaxed text-justify mb-4">
                        å·ç«¯åº·æˆç­†ä¸‹ã€Šé›ªåœ‹ã€‹çš„èˆå°ã€‚ã€Œç©¿éç¸£ç•Œé•·é•·çš„éš§é“ï¼Œä¾¿æ˜¯é›ªåœ‹ã€‚ã€é€™è£¡ä»¥é«˜å“è³ªçš„ç²‰é›ªå’Œã€Œè¶Šå…‰ç±³ã€èåã€‚é™¤äº†æ»‘é›ªï¼Œè»Šç«™å…§çš„ã€Œæ¸…é…’åšç‰©é¤¨ã€å¯ä»¥è©¦é£²è¿‘ç™¾ç¨®æ–°æ½Ÿæ¸…é…’ï¼Œåˆ¥å¿˜äº†å˜—è©¦ã€Œçˆ†å½ˆå¤§é£¯ç³°ã€ã€‚
                    </p>
                </div>
            </div>
        </section>

        <section id="wallet" class="tab-content">
            <div class="bg-muji-text text-white rounded-2xl p-5 mb-4 shadow-lg">
                <div class="flex justify-between items-end mb-2">
                    <span class="text-sm opacity-80">ä»Šæ—¥åŒ¯ç‡ (è‡ªè¨‚)</span>
                    <input type="number" id="exchangeRate" value="0.22" step="0.01" class="bg-white/20 text-right w-16 rounded px-1 text-sm text-white focus:outline-none border border-transparent focus:border-white">
                </div>
                <div class="flex flex-col">
                     <div class="relative">
                        <input type="text" id="calcInput" placeholder="è¼¸å…¥ç®—å¼ (å¦‚ 500+200*2)" class="w-full bg-transparent text-3xl font-bold text-right outline-none placeholder-white/30 font-mono mb-1">
                        <div class="text-right text-xs opacity-60 mb-2">æ”¯æ´ + - * / (æŒ‰ä¸‹ Enter è¨ˆç®—)</div>
                     </div>
                     <div class="h-[1px] bg-white/30 w-full mb-3"></div>
                     <div class="flex justify-between items-center">
                         <div>
                            <span class="text-xs opacity-70 block">JPY (Result)</span>
                            <span id="calcResultJPY" class="text-xl font-bold">0</span>
                         </div>
                         <div class="text-right">
                            <span class="text-xs opacity-70 block">TWD (ç´„)</span>
                            <span id="calcResultTWD" class="text-2xl font-bold text-muji-success">0</span>
                         </div>
                     </div>
                     <button onclick="calculate()" class="mt-3 w-full bg-white/20 hover:bg-white/30 py-2 rounded-lg text-sm font-bold transition">è¨ˆç®—ä¸¦æ›ç®—</button>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-4 mb-6 card-shadow">
                <h3 class="font-bold mb-3 text-muji-accent">æ–°å¢è¨˜å¸³</h3>
                <div class="grid grid-cols-3 gap-2 mb-2">
                    <input type="text" id="itemDesc" placeholder="å“é … (å¦‚: åˆé¤)" class="col-span-2 bg-stone-50 border border-stone-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-muji-accent">
                    <input type="number" id="itemPrice" placeholder="æ—¥å¹£" class="bg-stone-50 border border-stone-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-muji-accent">
                </div>
                
                <div class="flex items-center gap-2 mb-3">
                    <label class="flex-1 bg-stone-100 hover:bg-stone-200 text-muji-sub text-xs py-2 px-3 rounded-lg cursor-pointer flex items-center justify-center transition">
                        <i class="fas fa-camera mr-2"></i> ä¸Šå‚³ç…§ç‰‡
                        <input type="file" id="itemPhoto" accept="image/*" class="hidden" onchange="previewImage(this)">
                    </label>
                    <span id="fileName" class="text-xs text-muji-sub truncate max-w-[100px]">æœªé¸æ“‡</span>
                </div>
                <button onclick="addExpense()" class="w-full bg-muji-accent text-white py-2 rounded-lg font-bold shadow-md hover:bg-[#6b5b4d] transition">åŠ å…¥æ¸…å–®</button>
            </div>

            <h3 class="font-bold mb-3 flex justify-between items-center">
                æ¶ˆè²»ç´€éŒ„
                <span class="text-xs font-normal text-muji-sub">é•·æŒ‰å¯åˆªé™¤</span>
            </h3>
            <div id="expenseList" class="space-y-3 pb-20">
                <div class="text-center text-stone-400 text-sm py-10">å°šç„¡ç´€éŒ„</div>
            </div>
            
            <div class="h-10"></div>
        </section>

        <section id="lists" class="tab-content">
            <div class="bg-white rounded-2xl p-5 mb-6 card-shadow">
                <h2 class="font-bold text-muji-accent mb-3"><i class="fas fa-clipboard-check"></i> è¡Œå‰æº–å‚™æ¸…å–®</h2>
                <div class="flex gap-2 mb-3">
                    <input type="text" id="newCheckItem" placeholder="æ–°å¢é …ç›®..." class="flex-1 bg-stone-50 border border-stone-200 rounded-lg px-3 py-2 text-sm">
                    <button onclick="addCheckItem()" class="bg-stone-600 text-white px-4 rounded-lg"><i class="fas fa-plus"></i></button>
                </div>
                <ul id="checklist" class="space-y-2">
                    </ul>
            </div>

            <div class="bg-white rounded-2xl p-5 mb-6 card-shadow">
                <h2 class="font-bold text-muji-accent mb-3"><i class="fas fa-pen"></i> å€‹äººå‚™å¿˜éŒ„</h2>
                <p class="text-xs text-muji-sub mb-2">è¼¸å…¥ç¶²å€æœƒè‡ªå‹•è½‰ç‚ºé€£çµã€‚é»æ“Šç©ºç™½è™•è‡ªå‹•å„²å­˜ã€‚</p>
                <div id="memoDisplay" class="hidden mb-3 text-sm break-all space-y-2 bg-stone-50 p-3 rounded-lg border border-stone-100"></div>
                <textarea id="memoInput" rows="8" class="w-full bg-stone-50 border border-stone-200 rounded-lg p-3 text-sm focus:outline-none focus:border-muji-accent" placeholder="è¼¸å…¥æ‚¨çš„ç­†è¨˜..." onblur="saveMemo()"></textarea>
            </div>
        </section>

        <section id="info" class="tab-content">
             <div class="bg-white rounded-2xl p-5 mb-4 card-shadow border-l-4 border-blue-400">
                <h3 class="font-bold mb-2">å¤©æ°£é å ±</h3>
                <p class="text-sm mb-3">æŸ¥è©¢å¤§é˜ªã€äº¬éƒ½èˆ‡è¶Šå¾Œæ¹¯æ¾¤çš„å³æ™‚å¤©æ°£ã€‚</p>
                <a href="https://www.jma.go.jp/bosai/forecast/" target="_blank" class="inline-block bg-blue-50 text-blue-600 px-4 py-2 rounded-lg text-sm font-bold">å‰å¾€æ—¥æœ¬æ°£è±¡å»³</a>
             </div>

             <div class="bg-white rounded-2xl p-5 mb-4 card-shadow border-l-4 border-red-400">
                <h3 class="font-bold mb-2">ç·Šæ€¥è¯çµ¡</h3>
                <ul class="text-sm space-y-2">
                    <li>ğŸ‘® è­¦å¯Ÿå±€ï¼š<strong>110</strong></li>
                    <li>ğŸš‘ æ•‘è­·è»Š/ç«è­¦ï¼š<strong>119</strong></li>
                    <li>ğŸ‡¹ğŸ‡¼ å°åŒ—é§å¤§é˜ªç¶“æ¿Ÿæ–‡åŒ–è¾¦äº‹è™•ï¼š<br>
                        <a href="tel:+81-6-6227-8623" class="text-blue-600 underline">06-6227-8623</a><br>
                        (ç·Šæ€¥è¯çµ¡: 090-8794-4568)
                    </li>
                </ul>
             </div>

             <div class="bg-white rounded-2xl p-5 mb-4 card-shadow">
                 <h3 class="font-bold mb-2 text-muji-accent">âš ï¸ æ³¨æ„äº‹é …</h3>
                 <ul class="text-sm list-disc pl-5 space-y-1 text-muji-text">
                     <li>æ—¥æœ¬é›»å£“ç‚º 100Vï¼Œæ’åº§ç‚ºé›™å¹³è…³ï¼ˆèˆ‡å°ç£ç›¸åŒï¼‰ã€‚</li>
                     <li>æ—¥æœ¬é™¤äº†æŒ‡å®šå€åŸŸå¤–ï¼Œç¦æ­¢é‚Šèµ°é‚ŠæŠ½è¸ã€‚</li>
                     <li>é›»è»Šå…§è«‹å°‡æ‰‹æ©Ÿè¨­ç‚ºéœéŸ³ï¼Œé¿å…é€šè©±ã€‚</li>
                     <li>éƒ¨åˆ†æº«æ³‰åš´ç¦æœ‰åˆºé’è€…é€²å…¥ï¼Œè‹¥æœ‰åˆºé’è«‹å…ˆç¢ºèªæˆ–ä½¿ç”¨é®ç‘•è²¼ã€‚</li>
                     <li>å…¥å¢ƒæ—¥æœ¬è«‹äº‹å…ˆå¡«å¯« Visit Japan Webã€‚</li>
                 </ul>
             </div>
        </section>

    </main>

    <nav class="fixed bottom-0 w-full bg-white border-t border-stone-200 pb-safe pt-2 px-2 z-50 flex justify-around items-center h-[60px] pb-[max(env(safe-area-inset-bottom),10px)]">
        <button onclick="switchTab('plan')" class="nav-item active flex flex-col items-center p-2 w-1/5 text-stone-400 transition">
            <i class="fas fa-calendar-alt text-lg mb-1"></i>
            <span class="text-[10px] font-bold">PLAN</span>
        </button>
        <button onclick="switchTab('guide')" class="nav-item flex flex-col items-center p-2 w-1/5 text-stone-400 transition">
            <i class="fas fa-book-open text-lg mb-1"></i>
            <span class="text-[10px] font-bold">GUIDE</span>
        </button>
        <button onclick="switchTab('wallet')" class="nav-item flex flex-col items-center p-2 w-1/5 text-stone-400 transition relative">
            <div class="bg-muji-accent rounded-full w-12 h-12 flex items-center justify-center -mt-6 shadow-lg border-4 border-[#f5f5f0]">
                <i class="fas fa-wallet text-white text-xl"></i>
            </div>
            </button>
        <button onclick="switchTab('lists')" class="nav-item flex flex-col items-center p-2 w-1/5 text-stone-400 transition">
            <i class="fas fa-check-square text-lg mb-1"></i>
            <span class="text-[10px] font-bold">LISTS</span>
        </button>
        <button onclick="switchTab('info')" class="nav-item flex flex-col items-center p-2 w-1/5 text-stone-400 transition">
            <i class="fas fa-info-circle text-lg mb-1"></i>
            <span class="text-[10px] font-bold">INFO</span>
        </button>
    </nav>

    <script>
        /* --- Data & Initialization --- */
        const itineraryData = [
            { day: "DAY 1 | 1/24 (Sat)", title: "å¤§é˜ªåˆè¦‹é¢ ğŸ‘‹", details: [
                { time: "18:00", text: "æŠµé”é—œè¥¿æ©Ÿå ´ (KIX)", icon: "plane-arrival" },
                { time: "äº¤é€š", text: "å—æµ·é›»éµç©ºæ¸¯æ€¥è¡Œ â” å¤©ä¸‹èŒ¶å±‹ â” åŒ—æ¿± (3è™Ÿå‡ºå£)", icon: "subway" },
                { time: "20:30", text: "å…¥ä½ Hotel Forza Osaka Kitahama", icon: "hotel" },
                { time: "æ™šé¤", text: "é£¯åº—é™„è¿‘ç°¡å–®äº«ç”¨ (Fresco/æ¾å±‹)", icon: "utensils" }
            ]},
            { day: "DAY 2 | 1/25 (Sun)", title: "ç©æœ¨æµ·æ´‹èˆ‡çš®å¡ä¸˜ ğŸ³âš¡ï¸", details: [
                { time: "10:00", text: "å¤§é˜ªæ¨‚é«˜æ¨‚åœ’ (éœ€é ç´„)", icon: "cube", highlight: true },
                { time: "åˆé¤", text: "æµªèŠ±ç¾é£Ÿæ©«ä¸ (è‡ªç”±è»’/åŒ—æ¥µæ˜Ÿ)", icon: "utensils" },
                { time: "14:00", text: "æµ·éŠé¤¨è§€è³é¯¨é¯Š", icon: "fish" },
                { time: "16:30", text: "å¤©ä¿å±±å¤§æ‘©å¤©è¼ª", icon: "dharmachakra" },
                { time: "18:30", text: "Pokemon Cafe ä¸»é¡Œæ™šé¤ (12/25æ¶ç¥¨)", icon: "mug-hot", highlight: true }
            ]},
            { day: "DAY 3 | 1/26 (Mon)", title: "å¥”å‘é›ªåœ‹ ğŸš…â„ï¸", details: [
                { time: "è¡Œæ", text: "å¯„æ”¾å¤§è¡Œæï¼Œå¸¶3å¤©è¼•ä¾¿è¡Œæ", icon: "suitcase" },
                { time: "08:30", text: "æ–°å¤§é˜ª â” æ±äº¬è½‰è»Š â” è¶Šå¾Œæ¹¯æ¾¤", icon: "train" },
                { time: "14:30", text: "çŸ³æ‰“ä¸¸å±± The Veranda ç»ç’ƒå±‹", icon: "camera" },
                { time: "æ™šä¸Š", text: "å…¥ä½ å¾¡æ¹¯å®¿ ä¸­å±‹ (æº«æ³‰/æ™šé¤)", icon: "hot-tub" }
            ]},
            { day: "DAY 4 | 1/27 (Tue)", title: "æ»‘é›ªå°éšŠ Day 1 â›·ï¸", details: [
                { time: "08:30", text: "Snow Duck ç§Ÿè£å‚™", icon: "snowboarding" },
                { time: "09:30", text: "å²©åŸæ»‘é›ªå ´ (Iwappara) å…¨æ—¥æ»‘é›ª", icon: "mountain" },
                { time: "åˆé¤", text: "é›ªå ´é¤å»³ (Pizzeria La Locanda del Pittore)", icon: "pizza-slice" },
                { time: "16:00", text: "å›æ—…é¤¨æ³¡æ¹¯", icon: "hot-tub" }
            ]},
            { day: "DAY 5 | 1/28 (Wed)", title: "æ»‘é›ªç‰¹è¨“ Day 2 ğŸ¿", details: [
                { time: "09:30", text: "å²©åŸæ»‘é›ªå ´ ç¬¬äºŒå¤©", icon: "mountain" },
                { time: "15:30", text: "æ­¸é‚„è£å‚™", icon: "check" },
                { time: "16:30", text: "è¶Šå¾Œæ¹¯æ¾¤è»Šç«™ çˆ†å½ˆå¤§é£¯ç³°/æ¸…é…’è©¦å–", icon: "wine-glass" },
                { time: "æ™šé¤", text: "äººåƒäº­è±¬æ’ æˆ– ä¿å‰", icon: "utensils" }
            ]},
            { day: "DAY 6 | 1/29 (Thu)", title: "è‰è“èˆ‡å…‰ä¹‹éš§é“ ğŸ“âœ¨", details: [
                { time: "09:00", text: "æ­ä¹˜è§€å…‰è¨ˆç¨‹è»Š (åŒ…è»Š)", icon: "taxi", highlight: true },
                { time: "09:30", text: "æ¹¯æ¾¤è‰è“æ‘æ¡è‰è“", icon: "leaf" },
                { time: "11:00", text: "æ¸…æ´¥å³½ å…‰ä¹‹éš§é“", icon: "camera" },
                { time: "13:30", text: "æ–°å¹¹ç·šè¿”å›å¤§é˜ª", icon: "train" },
                { time: "æ™šé¤", text: "é“é “å € (ç« é­šç‡’ã€è·‘è·‘äºº)", icon: "map-marker-alt" }
            ]},
            { day: "DAY 7 | 1/30 (Fri)", title: "äº¬éƒ½åµå±±æ•£ç­– ğŸ‹", details: [
                { time: "äº¤é€š", text: "é˜ªæ€¥é›»éµ â” åµå±±ç«™", icon: "train" },
                { time: "10:00", text: "ç«¹æ—å°å¾‘ã€é‡å®®ç¥ç¤¾", icon: "tree" },
                { time: "åˆé¤", text: "Miffy Sakura Kitchen", icon: "bread-slice" },
                { time: "ä¸‹åˆ", text: "æ¸¡æœˆæ©‹æ•£æ­¥", icon: "walking" },
                { time: "æ™šé¤", text: "åœ‹ç”¢ç‰›ç‡’è‚‰ Aburiya (éœ€é ç´„)", icon: "utensils", highlight: true }
            ]},
            { day: "DAY 8 | 1/31 (Sat)", title: "ä¼è¦‹ç¨»è·èˆ‡å’Œæœ â›©ï¸", details: [
                { time: "09:00", text: "ä¼è¦‹ç¨»è·å¤§ç¤¾ (åƒæœ¬é³¥å±…)", icon: "torii-gate" },
                { time: "12:00", text: "ç¥‡åœ’èŠ±è¦‹å°è·¯", icon: "fan" },
                { time: "13:30", text: "æ¸…æ°´å¯ºã€äºŒä¸‰å¹´å‚", icon: "landmark" },
                { time: "é«”é©—", text: "ç©¿å’Œæœæ‹ç…§", icon: "user-friends" }
            ]},
            { day: "DAY 9 | 2/1 (Sun)", title: "å›å®¶å›‰ âœˆï¸", details: [
                { time: "08:00", text: "é€€æˆ¿ Check-out", icon: "sign-out-alt" },
                { time: "11:30", text: "IT211 èµ·é£›", icon: "plane-departure" }
            ]}
        ];

        const defaultChecklist = ["è­·ç…§", "æ©Ÿç¥¨é›»å­æª”/ç´™æœ¬", "Visit Japan Webæˆªåœ–", "ç¶²å¡/æ¼«éŠ", "æ—¥å¹£ç¾é‡‘", "ä¿¡ç”¨å¡(æµ·å¤–å›é¥‹)", "å€‹äººè—¥å“", "ä¿æš–è¡£ç‰©", "ç‰™åˆ·ç‰™è†(æ—¥æœ¬éƒ¨åˆ†é£¯åº—ä¸æä¾›)", "è½‰æ¥é ­/å……é›»å™¨"];

        // Init App
        document.addEventListener('DOMContentLoaded', () => {
            renderItinerary();
            loadExpenses();
            loadChecklist();
            loadMemo();
            
            // Calculator Input Enter Key
            document.getElementById('calcInput').addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                    calculate();
                }
            });
        });

        /* --- Tab Switching --- */
        function switchTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            // Show target
            document.getElementById(tabId).classList.add('active');
            
            // Update Nav styling
            const navBtn = document.querySelector(`button[onclick="switchTab('${tabId}')"]`);
            if(navBtn) navBtn.classList.add('active');
            
            // Scroll to top
            window.scrollTo(0,0);
        }

        /* --- PLAN Module --- */
        function renderItinerary() {
            const container = document.getElementById('itinerary-container');
            let html = '';
            
            itineraryData.forEach((day, index) => {
                html += `
                <div class="bg-white rounded-2xl p-0 mb-6 card-shadow overflow-hidden">
                    <div class="bg-stone-100 px-5 py-3 border-b border-stone-200">
                        <h3 class="font-bold text-muji-accent">${day.day}</h3>
                        <p class="text-sm text-muji-text">${day.title}</p>
                    </div>
                    <div class="p-5 relative">
                        <div class="timeline-line"></div>
                        <div class="space-y-6">
                `;
                
                day.details.forEach(item => {
                    const highlightClass = item.highlight ? "text-muji-danger font-bold" : "text-muji-text";
                    const bgClass = item.highlight ? "bg-red-50 border-red-100" : "bg-white";
                    
                    html += `
                        <div class="relative pl-8">
                            <div class="absolute left-0 top-1 w-8 flex justify-center timeline-dot">
                                <div class="w-2 h-2 rounded-full bg-stone-300 ring-4 ring-white"></div>
                            </div>
                            <div class="text-xs font-bold text-muji-sub mb-1 flex items-center gap-2">
                                <i class="fas fa-${item.icon} w-4 text-center"></i> ${item.time}
                            </div>
                            <div class="text-sm ${highlightClass}">${item.text}</div>
                        </div>
                    `;
                });
                
                html += `</div></div></div>`;
            });
            
            container.innerHTML = html;
        }

        /* --- WALLET Module --- */
        function calculate() {
            const input = document.getElementById('calcInput').value;
            const rate = parseFloat(document.getElementById('exchangeRate').value);
            try {
                // Safe-ish eval for calculator only allowing numbers and math operators
                if(/^[0-9+\-*/().\s]*$/.test(input)) {
                    const result = eval(input);
                    document.getElementById('calcResultJPY').innerText = Math.round(result).toLocaleString();
                    document.getElementById('calcResultTWD').innerText = Math.round(result * rate).toLocaleString();
                } else {
                    alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„ç®—å¼");
                }
            } catch (e) {
                alert("ç®—å¼éŒ¯èª¤");
            }
        }

        // Image Compression Logic
        let currentPhotoBase64 = null;

        function previewImage(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const img = new Image();
                img.onload = function() {
                    // Create Canvas
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Resize logic (Max width 400px to save space)
                    const maxWidth = 400;
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > maxWidth) {
                        height *= maxWidth / width;
                        width = maxWidth;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Compress to JPEG 0.6
                    currentPhotoBase64 = canvas.toDataURL('image/jpeg', 0.6);
                    document.getElementById('fileName').innerText = "å·²é¸å–åœ–ç‰‡";
                    document.getElementById('fileName').classList.add('text-green-600');
                }
                img.src = e.target.result;
            }
            reader.readAsDataURL(file);
        }

        function addExpense() {
            const desc = document.getElementById('itemDesc').value;
            const price = document.getElementById('itemPrice').value;
            
            if(!desc || !price) {
                alert("è«‹è¼¸å…¥é …ç›®èˆ‡é‡‘é¡");
                return;
            }

            const expense = {
                id: Date.now(),
                desc: desc,
                price: parseInt(price),
                photo: currentPhotoBase64,
                date: new Date().toLocaleDateString()
            };

            const expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
            expenses.unshift(expense); // Add to top
            
            try {
                localStorage.setItem('expenses', JSON.stringify(expenses));
            } catch (e) {
                alert("å„²å­˜å¤±æ•—ï¼šå®¹é‡å¯èƒ½å·²æ»¿ï¼Œè«‹åˆªé™¤éƒ¨åˆ†èˆŠç´€éŒ„æˆ–ä¸é™„ç…§ç‰‡ã€‚");
                return;
            }

            // Reset Form
            document.getElementById('itemDesc').value = '';
            document.getElementById('itemPrice').value = '';
            document.getElementById('itemPhoto').value = '';
            document.getElementById('fileName').innerText = "æœªé¸æ“‡";
            document.getElementById('fileName').classList.remove('text-green-600');
            currentPhotoBase64 = null;

            loadExpenses();
        }

        function loadExpenses() {
            const list = document.getElementById('expenseList');
            const expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
            const rate = parseFloat(document.getElementById('exchangeRate').value);

            if(expenses.length === 0) {
                list.innerHTML = '<div class="text-center text-stone-400 text-sm py-10">å°šç„¡ç´€éŒ„</div>';
                return;
            }

            let html = '';
            expenses.forEach(item => {
                const twd = Math.round(item.price * rate);
                const imgHtml = item.photo ? `<img src="${item.photo}" class="w-12 h-12 object-cover rounded-md border border-stone-200" onclick="showImage('${item.photo}')">` : `<div class="w-12 h-12 bg-stone-100 rounded-md flex items-center justify-center text-stone-300"><i class="fas fa-shopping-bag"></i></div>`;
                
                html += `
                <div class="bg-white p-3 rounded-xl card-shadow flex items-center gap-3 relative overflow-hidden" oncontextmenu="deleteExpense(${item.id}); return false;">
                    ${imgHtml}
                    <div class="flex-1">
                        <div class="text-sm font-bold text-muji-text">${item.desc}</div>
                        <div class="text-xs text-muji-sub">${item.date}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-bold">Â¥${item.price.toLocaleString()}</div>
                        <div class="text-xs text-muji-sub">â‰ˆ NT$${twd.toLocaleString()}</div>
                    </div>
                    <button onclick="deleteExpense(${item.id})" class="text-stone-300 hover:text-red-400 px-2"><i class="fas fa-times"></i></button>
                </div>`;
            });
            list.innerHTML = html;
        }

        function deleteExpense(id) {
            if(confirm("ç¢ºå®šåˆªé™¤é€™ç­†ç´€éŒ„ï¼Ÿ")) {
                let expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
                expenses = expenses.filter(e => e.id !== id);
                localStorage.setItem('expenses', JSON.stringify(expenses));
                loadExpenses();
            }
        }

        function showImage(src) {
            const w = window.open("");
            w.document.write(`<img src="${src}" style="max-width:100%">`);
        }

        /* --- LISTS Module --- */
        function loadChecklist() {
            let items = JSON.parse(localStorage.getItem('checklist'));
            if(!items) {
                items = defaultChecklist.map(t => ({text: t, checked: false}));
                localStorage.setItem('checklist', JSON.stringify(items));
            }
            renderChecklist(items);
        }

        function renderChecklist(items) {
            const ul = document.getElementById('checklist');
            ul.innerHTML = '';
            items.forEach((item, idx) => {
                const checkedClass = item.checked ? 'line-through text-stone-400' : 'text-muji-text';
                const iconClass = item.checked ? 'fa-check-square text-muji-success' : 'fa-square text-stone-300';
                
                ul.innerHTML += `
                <li class="flex items-center gap-3 bg-white p-3 rounded-lg border border-stone-100" onclick="toggleCheck(${idx})">
                    <i class="far ${iconClass} text-lg"></i>
                    <span class="${checkedClass} text-sm flex-1">${item.text}</span>
                    <button onclick="event.stopPropagation(); removeCheckItem(${idx})" class="text-stone-300"><i class="fas fa-trash-alt"></i></button>
                </li>`;
            });
        }

        function toggleCheck(idx) {
            let items = JSON.parse(localStorage.getItem('checklist'));
            items[idx].checked = !items[idx].checked;
            localStorage.setItem('checklist', JSON.stringify(items));
            renderChecklist(items);
        }

        function addCheckItem() {
            const input = document.getElementById('newCheckItem');
            const val = input.value.trim();
            if(val) {
                let items = JSON.parse(localStorage.getItem('checklist'));
                items.push({text: val, checked: false});
                localStorage.setItem('checklist', JSON.stringify(items));
                renderChecklist(items);
                input.value = '';
            }
        }

        function removeCheckItem(idx) {
            let items = JSON.parse(localStorage.getItem('checklist'));
            items.splice(idx, 1);
            localStorage.setItem('checklist', JSON.stringify(items));
            renderChecklist(items);
        }

        function loadMemo() {
            const memo = localStorage.getItem('memo') || '';
            document.getElementById('memoInput').value = memo;
            updateMemoDisplay(memo);
        }

        function saveMemo() {
            const val = document.getElementById('memoInput').value;
            localStorage.setItem('memo', val);
            updateMemoDisplay(val);
        }
        
        function updateMemoDisplay(text) {
            // Very basic URLify
            const container = document.getElementById('memoDisplay');
            if(!text) {
                container.classList.add('hidden');
                return;
            }
            container.classList.remove('hidden');
            // Regex to replace URLs with links
            const linkedText = text.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" class="text-blue-500 underline"><i class="fas fa-link"></i> é€£çµ</a>');
            // Replace newlines with br
            container.innerHTML = linkedText.replace(/\n/g, '<br>');
        }

    </script>
</body>
</html>